[see test code](docs/code/h5_structure_demo.py)

```
H5 File Structure:
┌─────────────────────────┐
│  cropped_volume_ROI.h5  │
├─────────────────────────┤
│  "data" (dataset name)  │
│  ┌───────────────────┐  │
│  │ 3D array          │  │
│  │                   │  │
│  │  D slices         │  │
│  │  ┌─────┐          │  │
│  │  │ H×W │  ← per slice │
│  │  └─────┘          │  │
│  │  ┌─────┐          │  │
│  │  │ H×W │          │  │
│  │  └─────┘          │  │
│  │  ...              │  │
│  │  ┌─────┐          │  │
│  │  │ H×W │          │  │
│  │  └─────┘          │  │
│  └───────────────────┘  │
│  Shape: (D, H, W)        │
└─────────────────────────┘
```

```
$ cd /Users/jy/Desktop/1_Personal_Proj/19_qt/DeepMatter-RandD-6.2 && python h5_structure_demo.py
```

```
================================================================================
H5 File Structure Demo (Using Real Project Data)
================================================================================
```

```
[Step 1] Load an actual H5 file in this project
--------------------------------------------------------------------------------
File path: data/project_test/history_001/preprocess/full/cropped_volume_FULL.h5
File size: 87.23 MB
```
```
[Step 2] Inspect the H5 file structure
--------------------------------------------------------------------------------
Keys in the H5 file: ['data']

Details of dataset 'data':
  Shape: (538, 466, 466)
  Dimension: 3D
  Data type: uint8
  Compression: gzip
  Data size (uncompressed): 111.42 MB
  Actual file size (compressed): 87.23 MB
  Compression ratio: 21.7%

```
```
[Step 3] Read sample data
--------------------------------------------------------------------------------
First slice (dataset[0, :, :]):
  Shape: (466, 466)
  Data type: uint8
  Value range: [10, 255]
  Mean: 86.04

First 10×10 region of the first slice:
[[ 75  80  91  99  95  84  79  83  86  97]
 [ 81  85  97  93  92  93  97  86  79  86]
 [101 102 106  90  95  84 106  80  65  79]
 [ 95  81  86  79 112 126 103  77  69  59]
 [ 92  81  81  89 100 104 102  83  60  39]
 [102  93  92  99  93  96  90  82  45  50]
 [ 96 105 102  98  73  77  88  62  42  41]
 [ 82 101 102  85  76  75  64  50  42  50]
 [ 85 104  88  73  75  54  40  31  52  58]
 [ 93  85  80  72  65  40  34  34  42  45]]

Middle slice (dataset[269, :, :]):
  Shape: (466, 466)
  Value range: [17, 147]
  Mean: 85.69

Last slice (dataset[-1, :, :]):
  Shape: (466, 466)
  Value range: [8, 220]
  Mean: 85.93
```
```
[Step 4] Read the full 3D array
--------------------------------------------------------------------------------
Data size is moderate, loading full array...
  Full array shape: (538, 466, 466)
  Array type: <class 'numpy.ndarray'>
  Data type: uint8
  Value range: [0, 255]
  Mean: 85.99
  Median: 89.00
```
```
[Step 5] Explanation of 3D dimensions
--------------------------------------------------------------------------------
Shape (D, H, W) = (538, 466, 466)
  D (depth / slice count) = 538 slices
  H (height) = 466 pixels
  W (width) = 466 pixels
  Total pixel count: 116,829,928
  Per-slice size: 466 × 466 = 217,156 pixels
```
```
[Step 6] Features of H5 files
--------------------------------------------------------------------------------
H5 (HDF5) file characteristics:
  1. Can store arbitrary-dimensional NumPy arrays (1D, 2D, 3D, 4D...)
  2. Supports compression (gzip, lzf)
  3. Allows partial reading (read slices without loading full file)
  4. Can contain multiple datasets (multiple arrays)
  5. Can store metadata
  6. Cross-platform and language-independent

In this project, the H5 file stores:
  - A single 3D array (shape D × H × W)
  - Dataset name: 'data'
  - Data type: uint8 (0–255, normalized)
  - Compression: gzip
  - Source: cropped volume generated by preprocess.py
```
```
[Step 7] Partial reading demo
--------------------------------------------------------------------------------
You can read slices on demand without loading the full array:
  Read slice 0: dataset[0, :, :]  → shape (466, 466)
  Read slice 134: dataset[134, :, :] → shape (466, 466)
  Read slice 269: dataset[269, :, :] → shape (466, 466)
  Read last slice: dataset[-1, :, :] → shape (466, 466)
  Read a cropped region: dataset[269, 116:349, 116:349] → shape (233, 233)

This is ideal for large 3D data processing.
```
```
[Step 8] Connection with preprocess.py
--------------------------------------------------------------------------------
How this H5 file is generated (workflow in preprocess.py):

1. Build the 3D array:
       d_slice_cropped_array = np.zeros((crop_d, crop_h, crop_w), dtype=np.float32)
       for i in range(crop_d):
           d_slice = read_image(slice_path).astype(np.float32)
           d_slice_cropped = d_slice[h_start:h_end, w_start:w_end]
           d_slice_cropped = ((d_slice_cropped - global_min) / (global_max - global_min)) * 255
           d_slice_cropped_array[i] = d_slice_cropped

2. Save as H5:
       with h5py.File("cropped_volume_ROI.h5", "w") as f:
           f.create_dataset("data", data=d_slice_cropped_array.astype(np.uint8), compression="gzip")

3. H5 file content:
       - A single 3D NumPy array
       - Stored in dataset "data"
       - Shape: (D, H, W)
       - Type: uint8 (0–255 normalized)
       - Compressed with gzip
```
```
================================================================================
Summary: An H5 file is simply a container storing 3D arrays.
================================================================================
Current file: data/project_test/history_001/preprocess/full/cropped_volume_FULL.h5
File size: 87.23 MB
Data shape: (538, 466, 466)
Data type: uint8 (0–255)
Compression: gzip
================================================================================



